@page "/admin/settings"
@layout GroceryStore.Components.Layout.AdminLayout
@inject ISettingsService SettingsService

<PageTitle>Store Settings | Admin</PageTitle>

<h2 style="margin-bottom:2rem;font-size:1.5rem;font-weight:700;">
    <i class="fas fa-cog" style="color:var(--primary);margin-right:.5rem;"></i>
    Store Settings
</h2>

<Toast @ref="_toast" />

@if (_loading)
{
    <div class="loading-spinner show"><div class="spinner"></div></div>
}
else if (_settings is not null)
{
    <div style="background:var(--surface);border-radius:var(--radius-lg);border:1px solid var(--border);padding:2.5rem;max-width:680px;">
        <EditForm Model="_settings" OnValidSubmit="Save">
            <DataAnnotationsValidator />

            <div style="display:grid;grid-template-columns:1fr 1fr;gap:1.5rem;">
                <div class="form-group" style="grid-column:1/-1;">
                    <label class="form-label">Store Name</label>
                    <InputText @bind-Value="_settings.StoreName" class="form-control" placeholder="e.g. Fresh Grocery Store" />
                </div>
                <div class="form-group">
                    <label class="form-label">Phone</label>
                    <InputText @bind-Value="_settings.Phone" class="form-control" placeholder="+964 750 ..." />
                </div>
                <div class="form-group">
                    <label class="form-label">WhatsApp Number</label>
                    <InputText @bind-Value="_settings.WhatsappNumber" class="form-control" placeholder="+9647501234567" />
                </div>
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <InputText @bind-Value="_settings.Email" class="form-control" placeholder="info@store.com" />
                </div>
                <div class="form-group">
                    <label class="form-label">Currency</label>
                    <InputText @bind-Value="_settings.Currency" class="form-control" placeholder="USD" />
                </div>
                <div class="form-group" style="grid-column:1/-1;">
                    <label class="form-label">Address</label>
                    <InputText @bind-Value="_settings.Address" class="form-control" placeholder="City, Country" />
                </div>
                <div class="form-group" style="grid-column:1/-1;">
                    <label class="form-label">Opening Hours</label>
                    <InputTextArea @bind-Value="_settings.OpeningHours" class="form-control" rows="3"
                                   placeholder="Sat – Thu: 8:00 AM – 10:00 PM&#10;Fri: 9:00 AM – 11:00 PM" />
                </div>
                <div class="form-group" style="grid-column:1/-1;">
                    <label class="form-label">Google Maps Embed URL</label>
                    <InputText @bind-Value="_settings.GoogleMapsUrl" class="form-control" placeholder="https://www.google.com/maps/embed?..." />
                </div>
            </div>

            <div style="display:flex;gap:1rem;justify-content:flex-end;margin-top:1rem;">
                <button type="submit" class="btn-submit" disabled="@_busy">
                    @if (_busy)
                    {
                        <i class="fas fa-spinner fa-spin"></i>
                    }
                    else
                    {

                        <i class="fas fa-save"></i>
                    }
                    Save Settings
                </button>
            </div>
        </EditForm>
    </div>
}

@code {
    private Toast? _toast;
    private bool _loading, _busy;
    private StoreSettings? _settings;

    protected override async Task OnInitializedAsync()
    {
        _loading = true;
        _settings = await SettingsService.GetSettingsAsync( );
        _loading = false;
    }

    private async Task Save()
    {
        if (_settings is null)
            return;
        _busy = true;
        _settings = await SettingsService.SaveSettingsAsync(_settings);
        _busy = false;
        _toast?.Show("Settings saved successfully!");
    }
}
